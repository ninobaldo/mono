\chapter{Rootkits}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%				MALWARE					%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Outros agentes infeciosos: O que não é um rootkit?

Malware é a junção das palavras em inglês \emph{malicious} com \emph{software}, esses termos em inglês pode ser traduzido livremente como aplicativo malicioso. Dessa forma podemos considerar como malware os vírus, worms, trojans, botnets kit dentro outros, contudo o inverso não é valido, ou seja, todo vírus é um malware, mas nem todo malware é um vírus.

% definição de malware, virus, botnet etc. \cite[p. 15]{BILL2009}. diferenças entre worm e vírus
% virus e worms, born to be spred
% 1980 - virus - floppy disk - display in to startup "Your computer is now stoned"
% 1988 - worm - Morris Worm
Os vírus e worms são feitos para se espalha a diferença está em como eles se espalham. O vírus precisa ser ativado ou executado pelo usuário e em geral fica atrelado a algum executavel que pode ser ou não um programa legitimo subvertido \cite{MARK1995}, ao contrário do worm que não precisam da ação direta do usuário para se espalhar e permanece apenas na memória \cite{MCAFEE2013}.

% botnet zombies
Uma \emph{botnet} é uma rede de computadores controlados por cybercriminosos \cite{KAS2013}. Basicamente quando um computador é infectado pelo agente da \emph{botnet} o mesmo se torna parte da rede e é controlado pelo dono da \emph{botnet}. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%				ROOTKIT					%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definição: O que é rootkit?
No universo \emph{UNIX\footnote{Um sistema operacional multiusuário amplamente utilizado.}} ou \emph{UNIX-like\footnote{Sistemas Operacionais baseados no Unix, como o GNU/Linux}} a conta de usuário com menor restrição de segurança é referênciada como conta \emph{root} sendo que em alguns sistemas o nome de usuário é literalmente root, mas isso é apenas uma convenção histórica do que uma imposição \cite{BILL2009}. Enquanto \emph{kit} significa conjunto de peças \cite{DIING}. 

Rootkit pode ser visto como um ``kit'' composto de pequenos programas úteism por exemplo, binários, scripts, arquivos de configuração que permitem a um atacante manter o acesso ``root''. Em outras palavras, um rootkit é um conjunto de programas e de código, que permite a presença permanente ou consistente, não detectável em um computador \cite{GREG2005}.

Essa coleção de ferramentas que permitem aos invasores ocultarem suas atividades em um computador, de modo que eles podem secretamente monitorar e controlar o sistema por um período prolongado, ou seja, existem três serviços que o são inerentes dos rootkits, ocultação, comando e controle (C2) e vigilância \cite{BILL2009}. Ocultação, o rootkit deve passar despercebido, sem que o usuário e/ou antivírus o detecte; vigilância ou monitoramento basicamente consiste em acompanhar as ações do usuário, o rootkit tem que ser capaz de saber o que o usuário está fazendo; e comando e controle, permite ao dono do rootkit o controle remoto sobre o mesmo, definindo suas ações e direcionando. Desses três serviços o mais importante para o rootkit é a furtividade, pois um rootkit detectável vai durar muito pouco.

Como pode ser visto cada um desses agentes subversivos tem definições e características próprias diferentes e uma em comum todos eles subvertem o sistema de alguma forma, contudo é bom resaltar que nem todo rootkit é um malware, pois existem aplicações legítimas para o mesmo, como de computadores coorporativos e inclusive aplicações investigativas.

%Historico
Os primeiros rootkits apareceram em de 20 anos atrás no fim dos anos 80 e início dos 90, quando alguns foram percebidos comportamentos anormais em computadores como espaço em disco utilizado sem identificação, conexões de rede não-listadas e uso anormal do CPU \cite{PR2011}. 

% Tipos
Para \citeonline{PAROS2009} os rootkits podem ter quatro tipos:

\begin{itemize}
  \item Ring 3 (User-mode): são rootkit que operam acima do sistema operacional como um aplicativo, mudando um aplicativo padrão ou injetando código na memória na área reservada a aplicações \emph{user-mode};
  \item Ring 0 (Kernel-mode): operam injetando código na área da memória reservada ao \emph{kernel}, adicionando código ao \emph{kernel}, modificando \emph{drivers} etc, ou seja, esse tipo de rootkit roda no mesmo nível do \emph{kernel};
  \item Hardware/Firmware based: os rootkit se instalam em \emph{firmwares} como placas de rede ou placas de vídeo, de forma que rodam indepententes do sistema operacional; e
  \item Virtualization based: feito para executar em ambientes virtualizados, estes rootkits executam junto ao sistema de virtualização para interceptar ou controlar as \emph{virtual machines}.
\end{itemize}

Como pode ser notado, o tipo de ambiente onde o rootkit executa define o seu tipo, por exemplo, um rootkit que só executa em memória, será um \emph{user-mode} ou \emph{kernel-mode} rootkit dependendo do lugar na memória que o mesmo irá utilizar.

























% o que o rootkit execucar sem ser percebido? Isso é fundamental para entender onde e o que o rootkit pode estar fazendo
% hunk interrupções
Basicamente o processador pode receber dois tipos de exceções, uma gerada por hardware chamada de externa e interrupções geradas por programas\cite[p. 6-2 Vol. 3A]{INT64IA322011}. A grosso modo, quando uma interrupção ou exceção ocorre o processador usa o endereço de memória armazenado no indice correspondente a interrupção lançada que por definição aponta para uma \emph{procedure} que trata a interrupção \cite{INT803861986}, ou seja, esse endereço na memória vai direcionar o processamento a \emph{procedure} especifica para a interrupção ou exceção que ocorreu. O rootkit pode interceptar uma chamada a tabela estrutura de dados com indices dessas tratativas como \emph{Interrupt Vector (IVT)} em modo real ou a \emph{Interrupt Descriptor Table (IDT)} em modo protegido, ambas as estruturas possuem funções similares, apesar da forma como trabalham ser muito distinta.

%pathing


% hook memory

% Ir em cada referencia e verificar se foi usada

falando assim parece uma tarefa fácil realizar qualquer um desses metodos...


% \begin{citacao}
% ``
% 1989: Primeiro alterador de logs é encontrado em sistemas corrompidos.
% 1994: Primeiros rootkits em sistemas operacionais da Sun são detectados.
% 1996: Primeiro rootkit para Linux aparece publicamente.
% 1997: Rootkits a nível de kernel (através de módulos carregáveis pelo kernel) são propostos
% na ``Phrack''.
% 1998: Rootkits que se instalam em níveis mais próximos ao hardware são propostos por Silvio
% Cesare.
% 2000: Rootkit a nível de biblioteca é lançado.
% 2002: Funções de ``sniffers'' começam a ser introduzidas em rootkits.
% 2005: SONY/BMG causam escândalos ao incluir rootkit antipirataria em seus CDs
% 2006: A pesquisadora de segurança Joanna Rutkowska cria o Blue Pill, um rootkit a nível
% de máquina virtual em hardware.
% 2007: Mebroot, um rootkit a nível de boot, é descoberto pela empresa de segurança iDefense.
% ''\cite[p. 13]{PR2011}
% \end{citacao}


%quem usa \cite[p. 13]{BILL2009}, usos para rootkit \cite{GREG2005} -> Why Do Rootkits Exist?

% Como ele pode subverter um sistema

% Análise, detecção e forense - montanaro.pdf

%bombas lógicas


% Mostrar o que ele pode fazer usando se possível com exemplos reais;
%resumo: rootkits com suas práticas comuns e respectivos históricos junto com algumas técnicas de subversão
%introdução: as práticas mais comuns e como o rootkit pode ser usado na antiforense Como o rootkit pode impedir a formação de provas;

% \cite{PR2011} rootkit em bios e em outros lugares (onde o pode se esconder?) ou placa de video (eko)

Jamie Butler, the creator of the FU rootkit


O uso de rootkits é limitado a usuários avançados sendo que seu desenvolvimento exige conhecimentos profundos tanto de arquitetura de computadores quanto do funcionamento do Sistema Operacional que o mesmo vai corromper.










Rootkits proporcionam uma grande variedades de opções e pode ser utilizado para quase tudo, 

vem sendo utilizado historicamente para subverter sistemas dando permissão 

O fato de alguns eventos e rootkits terem ficados famosos, como é o caso do stuxnet\cite{}, torna esse assunto muito interessante de ser abordado, porque 




A grosso modo rootkits sempre tentarão esconder sua presença e seus rastros, logo a antiforense desde o inicio já é parte ...

não são novidades e sua aplicação já não é 




e durante o avanço do trabalho, poderão ser notadas diversas formas de detecção de rootkits além de indícios de seu uso em análises.


 
 


